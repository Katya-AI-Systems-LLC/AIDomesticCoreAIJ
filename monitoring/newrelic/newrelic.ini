# New Relic Agent Configuration
# Documentation: https://docs.newrelic.com/docs/apm/agents/

# Application/Agent Configuration
# New Relic License Key (required)
license_key: ${NEW_RELIC_LICENSE_KEY}

# Application name
app_name: ${NEW_RELIC_APP_NAME:AIPlain-API}

# Environment
environment: ${NEW_RELIC_ENVIRONMENT:production}

# Enable the agent
agent_enabled: true

# High Security Mode
high_security: ${HIGH_SECURITY:false}

# API Host
api_host: ${API_HOST:collector.newrelic.com}
api_port: ${API_PORT:443}

# Apdex T (threshold for satisfactory response time in seconds)
apdex_t: 0.5

# Logging Configuration
log_file_name: ${LOG_FILE_NAME:newrelic_agent.log}
log_file_path: ${LOG_FILE_PATH:/var/log}
log_level: ${LOG_LEVEL:info}

# Enabled Monitoring Features
monitor_mode: true

# Transaction Tracer Configuration
transaction_tracer:
  enabled: true
  
  # Maximum number of transaction segments to capture
  max_segments: 500
  
  # Transaction threshold (in seconds)
  transaction_threshold: 1.0
  
  # Stack trace threshold (in seconds)
  stack_trace_threshold: 0.5
  
  # Explain plan threshold (in seconds)
  explain_plan_threshold: 0.5
  
  # Record SQL queries
  record_sql: obfuscated
  
  # Maximum SQL query length
  max_sql_length: 4096

# Error Collector Configuration
error_collector:
  enabled: true
  
  # Ignore specific error classes
  ignore_errors:
    - HTTPException
    - ClientError
  
  # Ignore specific status codes
  ignore_status_codes:
    - 404
    - 403
  
  # Record HTTP status codes
  capture_events: true

# Browser Monitoring (RUM)
browser_monitoring:
  enabled: true
  
  # Auto-instrument browser monitoring
  auto_instrument: true
  
  # Use SSL for RUM
  ssl_for_transaction_tracer: true

# Slow SQL Configuration
slow_sql:
  enabled: true
  
  # Slow SQL threshold (in seconds)
  threshold: 0.5
  
  # Explain plan for slow queries
  explain_plan_enabled: true
  
  # Max recorded slow SQLs
  max_explain_plans: 10

# Instance Reporting
instance_reporting:
  enabled: true

# Thread Profiler
thread_profiler:
  enabled: true
  
  # Only profile for a percentage of requests
  profile_request_sampling: 1.0

# Real User Monitoring
real_user_monitoring:
  enabled: true
  
  # Capture user attributes
  capture_attributes: true

# Custom Metrics
custom_metrics:
  enabled: true
  
  # Metrics prefixes
  prefixes:
    - Custom/
    - Quantum/
    - Vision/
    - Federated/

# APM Configuration
apm:
  enabled: true
  
  # Distributed tracing
  distributed_tracing:
    enabled: true
    enabled_sampling_target: 200
    enabled_sampling_target_period: 60

# Span Collection
span_events:
  enabled: true
  
  # Sample rate for span events (0.0-1.0)
  sample_rate: 0.1
  
  # Max span attributes
  max_samples_stored: 10000

# Database Configuration
database:
  # Database monitoring
  enabled: true
  
  # Database name normalization
  normalize: true
  
  # Max database query strings
  max_query_strings: 1000

# Kubernetes Configuration (if running in K8s)
kubernetes:
  enabled: true
  
  # Service name (auto-detected)
  service_name: ${NEW_RELIC_SERVICE_NAME}
  
  # Pod name (auto-detected)
  pod_name: ${NEW_RELIC_POD_NAME}
  
  # Namespace (auto-detected)
  namespace: ${NEW_RELIC_NAMESPACE}
  
  # Cluster name
  cluster_name: ${CLUSTER_NAME:primary}

# Synthetic Monitoring
synthetics:
  enabled: true
  
  # Monitor scripts
  monitors:
    - name: API Health Check
      type: SIMPLE
      frequency: 300
      locations:
        - AWS_US_EAST_1
      url: http://localhost:8000/health
    
    - name: Database Check
      type: SIMPLE
      frequency: 300
      locations:
        - AWS_US_EAST_1
      url: http://localhost:5432

# Custom Events
custom_events:
  enabled: true
  
  # Max custom events per minute
  max_samples_stored: 10000

# Proxy Configuration (if needed)
proxy:
  # enabled: true
  # host: proxy.example.com
  # port: 8080
  # user: username
  # password: password

# SSL Configuration
ssl:
  enabled: true
  verify_peer: true
  cert_bundle_path: /etc/ssl/certs/ca-bundle.crt

# Ignore Transactions
ignore_transactions:
  - "/health"
  - "/metrics"
  - "/status"

# Attributes Configuration
attributes:
  enabled: true
  
  # Include attributes
  include:
    - request.headers.host
    - request.method
    - response.status
    - http.statusCode
  
  # Exclude attributes
  exclude:
    - request.headers.authorization
    - request.headers.x-api-key
    - request.parameters.password
    - password
    - api_key
    - secret

# Custom Instrumentation
custom_instrumentation:
  enabled: true
  
  # Track specific methods
  track_methods:
    - QuantumOptimizer.optimize
    - VisionModel.predict
    - FederatedTrainer.train

# Deep Linking Configuration
deep_linking:
  enabled: true

# Data Management
data_management:
  # Retention (days)
  retention: 30
  
  # Encryption
  encryption: true

# Debugging
debug: ${NEW_RELIC_DEBUG:false}

# Environment Variables
# NEW_RELIC_LICENSE_KEY - License key (required)
# NEW_RELIC_APP_NAME - Application name
# NEW_RELIC_ENVIRONMENT - Environment name
# NEW_RELIC_LABELS - Labels (key:value)
# NEW_RELIC_LOG - Log file path
# NEW_RELIC_LOG_LEVEL - Log level (debug, info, warn, error, fatal)
# NEW_RELIC_DISTRIBUTED_TRACING_ENABLED - Enable distributed tracing
# NEW_RELIC_ATTRIBUTES_ENABLED - Enable attribute collection
