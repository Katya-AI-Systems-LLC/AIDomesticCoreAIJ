# Datadog Agent Configuration
# For more information on the Datadog Agent, see: https://docs.datadoghq.com/agent/

# Enable the Datadog Agent to collect and report data
enabled: true

# Datadog API key
api_key: ${DD_API_KEY}

# Site configuration (us or eu)
site: ${DD_SITE:datadoghq.com}

# Log collection
logs_enabled: true

# Metrics enabled
metrics_enabled: true

# APM/Tracing enabled
apm_enabled: true

# Profiling enabled
profiling_enabled: true

# Process monitoring enabled
process_agent_enabled: true

# System probe enabled (for network monitoring)
system_probe_enabled: true

# Hostname (auto-detected if not set)
# hostname: my-hostname

# Environment tags
env: ${DD_ENV:production}
service: ${DD_SERVICE:aiplatform-api}
version: ${DD_VERSION:1.0.0}

# Global tags added to all metrics
tags:
  - cluster:${CLUSTER_NAME:primary}
  - region:${REGION:us-east-1}
  - environment:${DD_ENV:production}
  - team:platform

# Log collection configuration
logs:
  enabled: true
  
  # Container logs
  container_collect_all: true
  
  # Pod annotation based configuration
  use_pod_labels: true
  
  # Service logs
  service_collection:
    enabled: true

# APM Configuration
apm:
  enabled: true
  
  # APM agent endpoint
  apm_url: http://localhost:8126
  
  # Environment variables for tracing
  trace_enabled: true
  
  # Sampling rules (% of traces to sample)
  sample_rate: 0.1  # Sample 10% of requests
  
  # Enable distributed tracing
  distributed_tracing:
    enabled: true
  
  # Service name mapping
  service_mapping:
    aiplatform-api: aiplatform
    postgres: database
    redis: cache

# Process Agent Configuration
process_agent:
  enabled: true
  
  # System probe configuration for network connections
  system_probe:
    enabled: true
    network_enabled: true

# Integrations
integrations:
  # Kubernetes integration
  kubernetes:
    enabled: true
    kubelet_tls_verify: false
    apiserver_client_crt: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    
    # Collect pod metrics
    pod_labels_to_hostnames: false
    
  # Docker integration
  docker:
    enabled: true
    socket: /var/run/docker.sock
    health_service_check: true
    
  # PostgreSQL integration
  postgres:
    enabled: true
    instances:
      - host: ${DB_HOST:localhost}
        port: 5432
        username: ${DB_USER:postgres}
        password: ${DB_PASSWORD}
        dbname: ${DB_NAME:aiplatform}
        ssl: false
        
  # Redis integration
  redis:
    enabled: true
    instances:
      - host: ${REDIS_HOST:localhost}
        port: 6379
        password: ${REDIS_PASSWORD}
        
  # Nginx integration
  nginx:
    enabled: true
    instances:
      - nginx_status_url: http://localhost/nginx_status
        
  # System metrics integration
  system:
    enabled: true
    
  # Network monitoring
  network:
    enabled: true
    collect_connection_state: true

# Metrics collection
metrics:
  # Enable system metrics
  system_metrics: true
  
  # Collect container metrics
  container_metrics: true
  
  # Network metrics
  network_metrics: true
  
  # Custom metrics endpoint
  custom_metrics:
    - /metrics
    - /metrics/custom

# Continuous Profiling
profiling:
  enabled: true
  
  # Profiling data endpoint
  endpoint: http://localhost:8126
  
  # Profiling configuration
  cpu_enabled: true
  heap_enabled: true
  wall_enabled: true

# Log Forwarding Configuration
log_forwarding:
  # Forward logs to Datadog
  enabled: true
  
  # Log parsing rules
  parsing:
    json_enabled: true
    grok_enabled: true
    
  # Log processing rules
  pipelines:
    - source: aiplatform
      filters:
        - query: "service:aiplatform-api"
          processor: json
    
    - source: kubernetes
      filters:
        - query: "pod_name:aiplatform-*"
          processor: json

# Security Agent Configuration
security_agent:
  enabled: true
  
  # Runtime security
  runtime:
    enabled: true
    
  # Compliance monitoring
  compliance:
    enabled: true
    frameworks:
      - cis
      - pci

# Datadog Synthetic Monitoring
synthetics:
  enabled: true
  
  # API tests
  api_tests:
    - name: API Health Check
      endpoints:
        - http://localhost:8000/health
      frequency: 5m
      alert_on_failure: true
    
    - name: API Metrics Endpoint
      endpoints:
        - http://localhost:8000/metrics
      frequency: 1m

# Debugging
debug: ${DD_DEBUG:false}
log_level: ${LOG_LEVEL:info}

# Health check endpoint
health:
  enabled: true
  port: 5555

# Additional environment variables
# DD_API_KEY - Datadog API key (required)
# DD_AGENT_HOST - Agent host (default: localhost)
# DD_AGENT_PORT - Agent port (default: 8126)
# DD_TRACE_AGENT_PORT - Trace agent port (default: 8126)
# DD_LOGS_AGENT_PORT - Logs agent port (default: 10516)
# DD_ENV - Environment name
# DD_SERVICE - Service name
# DD_VERSION - Version number
